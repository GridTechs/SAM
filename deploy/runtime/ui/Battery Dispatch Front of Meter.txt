Battery Dispatch Front of Meter
995
370
27
GroupBox

1
8
Name
5
9
AutoDCBox
X
3
333
Y
3
18
Width
3
655
Height
3
262
Tool Tip
5
0
Caption
5
26
Automated dispatch options
Bold
2
1
Label

1
13
Name
5
20
BatteryChargeOptions
X
3
33
Y
3
177
Width
3
219
Height
3
51
Tool Tip
5
0
Caption
5
74
For all non-manual dispatch options, select how the battery can be charged
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
GroupBox

1
8
Name
5
16
InputDispatchBox
X
3
333
Y
3
282
Width
3
655
Height
3
73
Tool Tip
5
0
Caption
5
22
Input Battery Dispatch
Bold
2
1
GroupBox

1
8
Name
5
18
StorageDispatchBox
X
3
6
Y
3
3
Width
3
985
Height
3
364
Tool Tip
5
0
Caption
5
27
Storage Dispatch Controller
Bold
2
1
Label

1
13
Name
5
18
batt_auto_fom_help
X
3
342
Y
3
36
Width
3
636
Height
3
48
Tool Tip
5
0
Caption
5
216
The automated dispatch models consider the PPA price, electricity rate, costs to cycle, and inverter clipping to decide when to charge and discharge, using one of the time horizon options.  See help for more details.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Divider

1
10
Name
5
25
batt_charge_options_label
X
3
30
Y
3
231
Width
3
252
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
22
Battery charge options
Bold
2
1
DataArray

1
10
Name
5
20
batt_custom_dispatch
X
3
510
Y
3
327
Width
3
184
Height
3
24
Tool Tip
5
0
Mode
3
1
Label
5
29
Battery custom dispatch input
Description
5
156
Custom battery dispatch allows a user to get the dispatch from another tool and input into SAM directly.  Power < 0 for charging, Power > 0 for discharging.
TabOrder
3
4294967295
Numeric

1
17
Name
5
15
batt_cycle_cost
X
3
756
Y
3
246
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
9
Name
5
22
batt_cycle_cost_choice
X
3
756
Y
3
219
Width
3
198
Height
3
24
Tool Tip
5
0
Items
6
2
Model cycle costs
Input cycle costs
Selection
3
4294967295
TabOrder
3
4294967295
Label

1
13
Name
5
27
batt_cycle_cost_description
X
3
618
Y
3
156
Width
3
360
Height
3
57
Tool Tip
5
0
Caption
5
139
When using the automated dispatch control, the model will cycle the battery only if the benefit is greater than the damage to the battery. 
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Divider

1
10
Name
5
22
batt_cycle_costs_label
X
3
615
Y
3
141
Width
3
363
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
19
Battery cycle costs
Bold
2
1
CheckBox

1
9
Name
5
29
batt_dispatch_auto_can_charge
X
3
36
Y
3
273
Width
3
228
Height
3
24
Tool Tip
5
0
Caption
5
30
Battery can charge from system
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
33
batt_dispatch_auto_can_clipcharge
X
3
36
Y
3
297
Width
3
288
Height
3
24
Tool Tip
5
0
Caption
5
44
Battery can charge from clipped system power
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
37
batt_dispatch_auto_can_fuelcellcharge
X
3
36
Y
3
321
Width
3
288
Height
3
24
Tool Tip
5
0
Caption
5
34
Battery can charge from fuel cell 
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
33
batt_dispatch_auto_can_gridcharge
X
3
36
Y
3
249
Width
3
234
Height
3
24
Tool Tip
5
0
Caption
5
28
Battery can charge from grid
State
2
1
TabOrder
3
4294967295
RadioChoice

1
11
Name
5
20
batt_dispatch_choice
X
3
33
Y
3
51
Width
3
294
Height
3
111
Tool Tip
5
0
Selection
3
4
Items
6
5
Automated dispatch: Perfect look ahead
Automated dispatch: 1-day look behind
Automated dispatch: Input forecast
Input custom dispatch
Manual dispatch
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
4294967295
Label

1
13
Name
5
19
batt_dispatch_label
X
3
354
Y
3
297
Width
3
627
Height
3
27
Tool Tip
5
0
Caption
5
75
Input a custom battery power dispatch (<0 for charging, >0 for discharging)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Divider

1
10
Name
5
21
batt_dispatch_options
X
3
342
Y
3
141
Width
3
264
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
16
Dispatch options
Bold
2
1
Numeric

1
17
Name
5
36
batt_dispatch_update_frequency_hours
X
3
513
Y
3
162
Width
3
48
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
21
batt_look_ahead_hours
X
3
513
Y
3
189
Width
3
48
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Button

1
8
Name
5
33
batt_select_weather_file_forecast
X
3
342
Y
3
111
Width
3
90
Height
3
24
Tool Tip
5
0
Caption
5
9
Browse...
TabOrder
3
4294967295
TextEntry

1
11
Name
5
32
batt_user_specified_weather_file
X
3
438
Y
3
111
Width
3
516
Height
3
24
Tool Tip
5
0
Text
5
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Divider

1
10
Name
5
18
batt_weather_label
X
3
342
Y
3
87
Width
3
636
Height
3
19
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
28
Choose Weather forecast file
Bold
2
1
Divider

1
10
Name
5
9
object 21
X
3
21
Y
3
27
Width
3
258
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
21
Choose Dispatch Model
Bold
2
1
Button

1
8
Name
5
19
select_weather_file
X
3
780
Y
3
678
Width
3
90
Height
3
24
Tool Tip
5
0
Caption
5
9
Browse...
TabOrder
3
9
Button

1
8
Name
5
21
select_weather_file23
X
3
780
Y
3
678
Width
3
90
Height
3
24
Tool Tip
5
0
Caption
5
9
Browse...
TabOrder
3
9
Button

1
8
Name
5
21
select_weather_file24
X
3
780
Y
3
678
Width
3
90
Height
3
24
Tool Tip
5
0
Caption
5
9
Browse...
TabOrder
3
9

14
batt_auto_gridcharge_max_daily
3
1
Maximum percent per day
%
Battery
0
2
1
1
1
1
100
Numeric
batt_custom_dispatch
3
2
Input battery dispatch
kWdc
Battery
0
2
1
2
1
1
0
Default
batt_cycle_cost
3
1
Battery cycle costs
$/cycle-kWh
Battery
0
2
1
1
1
1
0.1
Numeric
batt_cycle_cost_choice
3
1
Battery cycle cost choice
 
Battery
0
0
1
1
1
1
0
Choice
batt_dispatch_auto_can_charge
3
1
Battery can charge from unclipped PV
 
Battery
0
3
1
1
1
1
1
CheckBox
batt_dispatch_auto_can_clipcharge
3
1
Battery can charge from otherwise clipped PV power
kW
Battery
0
3
1
1
1
1
1
CheckBox
batt_dispatch_auto_can_fuelcellcharge
3
1
 
 
Battery
0
3
1
1
1
1
0
CheckBox
batt_dispatch_auto_can_gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
CheckBox
batt_dispatch_choice
3
1
Battery dispatch choice front-of-meter
 
Battery
150
Automated dispatch: Perfect look ahead|Automated dispatch: 1-day look behind|Automated dispatch: Input forecast|Input battery dispatch|Manual dispatch
3
1
1
1
1
0
RadioChoice
batt_dispatch_update_frequency_hours
3
1
Frequency to update dispatch
hours
Battery
0
2
1
1
1
1
24
Numeric
batt_look_ahead_hours
3
1
Look-ahead period
hours
Battery
0
2
1
1
1
1
18
Numeric
batt_pv_clipping_forecast
3
2
PV clipping forecast power
kW
Battery
0
3
1
2
1
1
0
Default
batt_pv_dc_forecast
3
2
PV dc forecast power
kW
Battery
0
0
1
2
1
1
0
Default
batt_user_specified_weather_file
3
4
Weather forecast file on disk
 
Battery
0
1
1
4
0
TextEntry

0
3384
on_load{'Financial TOD Factors'} = define()
{	
	toggle_inputs();
};

on_change{'ppa_multiplier_model'} = define()
{
	toggle_inputs();
};

function toggle_inputs()
{
	// enable time series
	en_ts = value('ppa_multiplier_model') == 1; 
	
	//time series inputs
	enable('dispatch_factors_ts', en_ts );
	
	//schedule inputs
	enable('apply_tod_library_values', !en_ts );
	enable('tod_library', !en_ts );
	enable( 'dispatch_sched_weekday', !en_ts );
	enable( 'dispatch_sched_weekend', !en_ts );
	enable( 'dispatch_factor1', !en_ts );
	enable( 'dispatch_factor2', !en_ts );
	enable( 'dispatch_factor3', !en_ts );
	enable( 'dispatch_factor4', !en_ts );
	enable( 'dispatch_factor5', !en_ts );
	enable( 'dispatch_factor6', !en_ts );
	enable( 'dispatch_factor7', !en_ts );
	enable( 'dispatch_factor8', !en_ts );
	enable( 'dispatch_factor9', !en_ts );
	enable( 'btnSaveDispatchData', !en_ts );
	enable( 'btnLoadDispatchData', !en_ts );
	enable( 'dispatch_data_filename', !en_ts );
}

on_change{'apply_tod_library_values'} = define() {

	value( 'dispatch_sched_weekday', value('lib_dispatch_sched_weekday') );
	value( 'dispatch_sched_weekend', value('lib_dispatch_sched_weekend') );
	value( 'dispatch_factor1',       value('lib_dispatch_factor1')       );
	value( 'dispatch_factor2',       value('lib_dispatch_factor2')       );
	value( 'dispatch_factor3',       value('lib_dispatch_factor3')       );
	value( 'dispatch_factor4',       value('lib_dispatch_factor4')       );
	value( 'dispatch_factor5',       value('lib_dispatch_factor5')       );
	value( 'dispatch_factor6',       value('lib_dispatch_factor6')       );
	value( 'dispatch_factor7',       value('lib_dispatch_factor7')       );
	value( 'dispatch_factor8',       value('lib_dispatch_factor8')       );
	value( 'dispatch_factor9',       value('lib_dispatch_factor9')       );
	
};

on_change{'btnSaveDispatchData'} = define() {
	logmsg('running btnSaveDispatchData');
	file = choose_file( '', 'Save TOD Factors Data As', 
		'Data Files (*.csv)|*.csv', true);
		
	if ( file != '' ) {
		file = replace(file, '\\', '/');
		if (group_write('Time of Delivery Factors',file))
		{	
			value( 'dispatch_data_filename', file );
			msgbox("Data saved! \n");
		}
		else
		{
			value( 'dispatch_data_filename', "" );
			msgbox("Data save failed! \n");
		}
	}
};

on_change{'btnLoadDispatchData'} = define() {
	logmsg('running btnLoadDispatchData');
	file = choose_file( '', 'Open TOD Factors File', 
		'Data Files (*.csv)|*.csv');
		
	if ( file != '' ) {
		file = replace(file, '\\', '/');
		update = false;
		data = csvread(file);
		for ( i=0; i<#data; i++ )
		{
			row = data[i];
			if ( row[0] == 'use_tod_library_values' )
			{
				update = yesno('Update TOD data file before loading?\nSAM cannot load your TOD data file because it contains the variable \'use_tod_library_values\' from an older version of SAM that this version of SAM does not use. Click Yes if you want SAM to remove that variable from the file before loading it. Click No to return to the TOD factors page without modifying or loading the file.');
				if (update == true )
				{
					data -@ i;
					csvwrite( file, data );
				}
			}	
		}

		if (group_read('Time of Delivery Factors',file))
		{	
			value( 'dispatch_data_filename', file );
			msgbox("Data loaded! \n");
		}
		else
		{
			value( 'dispatch_data_filename', "" );
			msgbox("Data load failed! \n");
		}
	}
};
